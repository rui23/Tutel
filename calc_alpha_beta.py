import numpy as np
import matplotlib.pyplot as plt

# a2a
# list1=[33554432, 67108864, 134217728, 268435456, 536870912, 1073741824, 67108864, 134217728, 268435456, 536870912, 1073741824, 2147483648, 134217728, 268435456, 536870912, 1073741824, 2147483648, 4294967296, 67108864, 134217728, 268435456, 536870912, 1073741824, 2147483648, 134217728, 268435456, 536870912, 1073741824, 2147483648, 4294967296, 268435456, 536870912, 1073741824, 2147483648, 4294967296, 8589934592]
# list2=[0.019772512, 0.038933223, 0.079664272, 0.175449795, 0.37530371, 0.742019951, 0.03922044, 0.081266814, 0.177301747, 0.364406991, 0.743445331, 1.538049442, 0.090552437, 0.173984802, 0.353474021, 0.769064569, 1.474575186, 3.124505925, 0.045873654, 0.080629039, 0.176369703, 0.35188694, 0.762057137, 1.596700346, 0.084248221, 0.17550534, 0.362538636, 0.799434602, 1.510906696, 3.053610396, 0.174079394, 0.372260034, 0.76297251, 1.567675829, 3.063031137, 5.671060145]
# list1 = [33554432, 22369621.33, 16777216, 67108864, 44739242.67, 33554432, 67108864, 44739242.67, 33554432, 134217728, 89478485.33, 67108864, 134217728, 89478485.33, 67108864, 268435456, 178956970.7, 134217728]
# list2 = [0.011438426, 0.007943912, 0.006062185, 0.02492044, 0.015884936, 0.011904469, 0.028231807, 0.02281183, 0.027655714, 0.053200531, 0.054829748, 0.034469909, 0.060280647, 0.048119857, 0.031389965, 0.110242832, 0.092260832, 0.060171819]
list1 = [67108864, 134217728, 268435456, 536870912, 1073741824, 536870912, 1073741824, 2147483648, 4294967296, 8589934592, 3221225472, 6442450944]
list2 = [0.005972803, 0.014342093, 0.033417135, 0.067755044, 0.123370153, 0.067452663, 0.122606134, 0.244656688, 0.484724092, 0.968195653, 0.363543624, 0.731488883]

# gemm
# list1 = [17179869184, 34359738368, 68719476736, 2.06158E+11, 2.40518E+11, 3.71078E+11, 34359738368, 68719476736, 1.37439E+11, 4.12317E+11, 4.81036E+11, 7.42157E+11, 68719476736, 1.37439E+11, 2.74878E+11, 8.24634E+11, 9.62073E+11, 1.48431E+12, 1.37439E+11, 2.74878E+11, 5.49756E+11, 1.64927E+12, 1.92415E+12, 2.96863E+12, 2.74878E+11, 5.49756E+11, 1.09951E+12, 3.29853E+12, 3.84829E+12, 5.93726E+12, 1.18745E+13, 2.3749E+13, 4.7498E+13, 4.7498E+13, 7.03687E+13, 6.15727E+13, 7.03687E+13, 8.79609E+13, 9.49961E+13, 1.40737E+14]
# list2 = [0.000721598, 0.001145661, 0.002257216, 0.006028891, 0.006997383, 0.010737562, 0.001265061, 0.002088475, 0.003828311, 0.010495901, 0.012256706, 0.018905878, 0.001873684, 0.003644204, 0.00687573, 0.019604242, 0.022917593, 0.036506593, 0.003476226, 0.006605923, 0.01277734, 0.03948487, 0.047530091, 0.077661383, 0.006642568, 0.012722635, 0.024953628, 0.084047294, 0.101274502, 0.156194663, 0.316145837, 0.637574422, 1.317318428, 1.366784871, 2.039463695, 1.742783006, 2.02743152, 2.53596185, 2.770120871, 4.082324553]
x = np.array(list1)
y = np.array(list2)

# 最小二乘法1
# A = np.vstack([x, np.ones(len(x))]).T
# m, c = np.linalg.lstsq(A, y, rcond=None)[0]

# 最小二乘法2
# 使用numpy的polyfit函数来找到最佳的线性关系
coefficients = np.polyfit(x, y, 1)  # 这里的1表示我们寻找一次多项式
# coefficients返回的是[m, c]，其中m是斜率，c是截距
m, c = coefficients

# 绘制图像
name = 'AlltoAll'
# name = 'GEMM'
plt.scatter(x, y, label='Data points')
plt.plot(x, m*x + c, 'r', label='Fitted line')
plt.xlabel('Input size [bytes]', fontsize=20)
plt.ylabel(f'{name} elapsed time [s]', fontsize=20)
plt.tick_params(axis='both', which='major', labelsize=20)
plt.legend(fontsize=20)
# plt.title(f'Least squares fit of {name}')

plt.tight_layout()
# 保存图像
plt.savefig(f'least_squares_fit_{name}.png')

print(f'{name} beta = {m}, alpha = {c}')